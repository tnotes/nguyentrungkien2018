<!DOCTYPE html>
<!--[if IE 8]>
<html lang="en" class="ie8"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en">
<!--<![endif]-->
<head>
    <meta charset="utf-8">
    <title>Thêm thông tin tài khoản Cookie</title>
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport">
    <meta content="" name="description">
    <meta content="" name="author">
    <script src="https://cdn.jsdelivr.net/npm/vue@2.5.17/dist/vue.js"></script>
    <script src="https://unpkg.com/vuex@3.0.1/dist/vuex.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.auto.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.4.5/socket.io.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <!-- ================== BEGIN BASE CSS STYLE ================== -->
    <link href="/css/css.css" rel="stylesheet">
    <link href="/css/jquery-ui.min.css" rel="stylesheet">
    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/all.min.css" rel="stylesheet">
    <link href="/css/ionicons.min.css" rel="stylesheet">
    <link href="/css/animate.min.css" rel="stylesheet">
    <link href="/css/style.min.css" rel="stylesheet">
    <link href="/css/style-responsive.min.css" rel="stylesheet">
    <link href="/css/default.css" rel="stylesheet" id="theme">
    <!-- ================== END BASE CSS STYLE ================== -->

    <!-- ================== BEGIN PAGE LEVEL STYLE ================== -->
    <link href="/css/dataTables.bootstrap.min.css" rel="stylesheet">
    <link href="/css/responsive.bootstrap.min.css" rel="stylesheet">
    <!-- ================== END PAGE LEVEL STYLE ================== -->
    <script src="/store/index.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.0/animate.min.css">
    <!-- ================== BEGIN BASE JS ================== -->
    <script src="/js/pace.min.js"></script>
    <style>
        .trashremove{

        }
        .trashremove:hover{
            cursor: pointer;
        }
    </style>
    <!-- ================== END BASE JS ================== -->
</head>
<body>
<!-- begin #page-loader -->
<div id="page-loader" class="fade show"><span class="spinner"></span></div>
<!-- end #page-loader -->

<!-- begin #page-container -->
<div id="bodyC" class="animated bounce fast">
    <div id="page-container">

        <div id="content">
            <div class="row">

                <div class="col-lg-12 ui-sortable">
                    <div class="panel panel-inverse">
                        <!-- begin panel-heading -->

                        <div style="background-color: #2c3e50" class="panel-heading ui-sortable-handle">
                            <a href="/" style="color:white"> <i class="fa fa-home"></i> Quay lại </a>
                            <span style="float: right;margin-right:600px" class="animated flash slow" ><i class="fa fa-user-circle "  ></i> Thông tin tài khoản</span>


                        </div>
                        <!-- end panel-heading -->
                        <!-- begin panel-body -->

                        <div class="panel-body panel-form">
                            <div class="form-horizontal form-bordered">
                                <div class="form-group row">
                                    <label class="col-md-4 col-form-label">Cookie</label>
                                    <div class="col-md-8">
                                        <div class="input-group date" >
                                            <textarea spellcheck="false" v-model="cookie" class="form-control" rows="3"></textarea>

                                        </div>
                                    </div>
                                </div>

                                <div class="form-group row">
                                    <label class="col-md-4 col-form-label"></label>
                                    <div class="col-md-8">
                                        <button v-show="buttonAdd" class="btn btn-primary" @click="addfacebookaccount"><i class="fa fa-paper-plane"></i> Thêm</button>
                                        <span v-show="loadingAdd"><img src="/img/load.svg" alt=""> Đang xử lí <span class="animated flash infinite delay-1s"> . . .  </span></span>
                                        <button class="btn btn-danger">Hủy</button>
                                        <code >{{error}}</code>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- end panel-body -->
                    </div>
                </div>
            </div>
            <div class="panel panel-inverse">
                <div class="panel-body">
                    <table class="table table-striped table-bordered">
                        <thead>
                        <tr>
                            <th width="1%">STT</th>
                            <th class="text-nowrap"></th>

                            <th class="text-nowrap">ID</th>
                            <th class="text-nowrap">Facebook</th>

                            <th class="text-nowrap">Tình trạng</th>
                            <th class="text-nowrap"></th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr class="odd gradeX" v-for="(data,index) in container.account" :key="index">
                            <td width="1%" class="f-s-600 text-inverse">{{index+1}}</td>
                            <td><img :src="data.FacebookImage" alt=""></td>
                                <td>{{data.ID_sender}}</td>
                            <td><a target="_blank" :href="data.FacebookUrl">{{data.FacebookName}}</a></td>

                            <td v-if="data.status === 'active'"><i class="fa fa-check-square" style="color:green"></i> <span style="color:green"> Đang hoạt động</span></td>
                            <td v-if="data.status === 'Cookie đã hết hạn.Vui lòng lấy lại Cookie' || data.status === 'Thông tin Tài khoản mật khẩu không chính xác hoặc đã bị checkpoint'"><i class="fa fa-check-square" style="color:red"></i> <span class="animated infinite flash" style="color:red">{{data.status}}</span></td>

                            <td><center><i class="fa fa-trash-alt trashremove" style="color:red" @click="remove(data.ID_sender)"></i></center> </td>
                        </tr>


                        </tbody>
                    </table>
                </div>
                <!-- end panel-body -->
            </div>
            <!-- end panel -->
        </div>

    </div>
</div>
<!-- end page container -->

<!-- ================== BEGIN BASE JS ================== -->
<script src="/js/jquery-3.3.1.min.js"></script>
<script src="/js/jquery-ui.min.js"></script>
<script src="/js/bootstrap.bundle.min.js"></script>

<script src="/js/jquery.slimscroll.min.js"></script>
<script src="/js/js.cookie.js"></script>
<script src="/js/apple.min.js"></script>
<script src="/js/apps.min.js"></script>
<!-- ================== END BASE JS ================== -->

<!-- ================== BEGIN PAGE LEVEL JS ================== -->
<script src="/js/jquery.dataTables.js"></script>
<script src="/js/dataTables.bootstrap.min.js"></script>
<script src="/js/dataTables.responsive.min.js"></script>
<script src="/js/table-manage-default.demo.min.js"></script>
<!-- ================== END PAGE LEVEL JS ================== -->

<script>
    $(document).ready(function () {
        App.init();
        TableManageDefault.init();
    });
</script>
<script>
    function setCookie(cname,cvalue,exdays) {
        var d = new Date();
        d.setTime(d.getTime() + (exdays*24*60*60*1000));
        var expires = "expires=" + d.toGMTString();
        document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
    }

    function getCookie(cname) {
        var name = cname + "=";
        var decodedCookie = decodeURIComponent(document.cookie);
        var ca = decodedCookie.split(';');
        for(var i = 0; i < ca.length; i++) {
            var c = ca[i];
            while (c.charAt(0) == ' ') {
                c = c.substring(1);
            }
            if (c.indexOf(name) == 0) {
                return c.substring(name.length, c.length);
            }
        }
        return "";
    }
    var app = new Vue({
        el: "#bodyC",
        data(){
            return {

                prefix:"http://localhost",
                store:[],
                cookie:'',
                usernameC:getCookie("email"),
                passwordC:getCookie("password"),
                buttonAdd:true,
                loadingAdd:false,
                error:''



            }
        },

        created:async function(){

            let allAccount = await axios.post('/api/getAllAccount');
            let result = allAccount.data.data.filter(e=>{
                if(e.type === 'cookie'){
                    return e
                }
            });
            return store.state.account = result


        },
        computed: {
            container () {
                return store.state
            }
        },
        methods:{

            addfacebookaccount:async function(){
                this.buttonAdd = false;
                this.loadingAdd = true;
                let _ = this;

                let result = this.cookie.split('\n').map(e=>{
                    let objResult = {};
                    this.cookie.split(';').filter(e=>{
                        if(e.trim().length >0){
                            return e
                        }
                    }).map(e=>{
                        objResult[e.split('=')[0].trim()] = e.split('=')[1].trim()
                    });
                    return objResult
                });

                this.cookie = '';

                let send = await axios.post('/api/account',{type:'cookie',data:result})

                 if(send.data.error === null){

                     this.container.account.push(send.data)
                 }else {

                    this.error = send.data.error;
                     setTimeout(function () {
                         _.error = '';
                     },2000)
                 }
                this.buttonAdd = true;
                this.loadingAdd = false;


            },
            remove:async function(id){


                let del = await axios.post('/api/deleteAccount',{ID_sender:id});
                store.state.account = store.state.account.filter(e=>{
                    if(e.ID_sender !== id){
                        return e
                    }
                })


            }


        },
    });
</script>
</body>
</html>
