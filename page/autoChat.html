<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en">
<!--<![endif]-->
<head>
    <meta charset="utf-8">
    <title>Message Management</title>
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport">
    <meta content="" name="description">
    <meta content="" name="author">
    <script src="https://cdn.jsdelivr.net/npm/vue@2.5.17/dist/vue.js"></script>
    <script src="https://unpkg.com/vuex@3.0.1/dist/vuex.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.auto.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.4.5/socket.io.min.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <!-- ================== BEGIN BASE CSS STYLE ================== -->
    <link href="/css/css.css" rel="stylesheet">
    <link href="/css/jquery-ui.min.css" rel="stylesheet">
    <link href="/css/bootstrap.min.css" rel="stylesheet">
    <link href="/css/all.min.css" rel="stylesheet">
    <link href="/css/animate.min.css" rel="stylesheet">
    <link href="/css/style.min.css" rel="stylesheet">
    <link href="/css/style-responsive.min.css" rel="stylesheet">
    <link href="/css/default.css" rel="stylesheet" id="theme">
    <script src="/store/index.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.0/animate.min.css" rel="stylesheet">
    <!-- ================== END BASE CSS STYLE ================== -->

    <!-- ================== BEGIN BASE JS ================== -->
    <script src="/js/pace.min.js"></script>
    <style>
        .cur {

        }

        .cur:hover {
            cursor: pointer;
        }

        body {
            overflow-x: hidden;
        }

        /* width */
        ::-webkit-scrollbar {
            height: 3px;
            width: 5px;
        }

        /* Track */
        ::-webkit-scrollbar-track {
            box-shadow: inset 0 0 5px grey;
            border-radius: 10px;
        }

        /* Handle */
        ::-webkit-scrollbar-thumb {
            background: #a6a8ad;
            border-radius: 10px;
        }

        /* Handle on hover */
        ::-webkit-scrollbar-thumb:hover {
            background: #574e4f;
        }
    </style>
    <!-- ================== END BASE JS ================== -->
</head>
<body>
<!-- begin page-cover -->
<div class="page-cover"></div>
<!-- end page-cover -->

<!-- begin #page-loader -->
<div id="page-loader" class="fade show"><span class="spinner"></span></div>
<!-- end #page-loader -->

<!-- begin #page-container -->
<div class="fade page-sidebar-fixed page-header-fixed page-content-full-height" id="page-container">

    <!-- begin #content -->
    <!-- begin #header -->
    <div class="header navbar-default show-bg" id="header">
        <!-- begin navbar-header -->
        <div class="navbar-header">
            <a class="navbar-brand"><span class="navbar-logo"></span> <b>Facebook</b> Manager</a>
            <button class="navbar-toggle" data-click="sidebar-toggled" type="button">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
        </div>
        <!-- end navbar-header -->

        <!-- begin header-nav -->
        <ul class="navbar-nav navbar-right">
            <li>
                <form class="navbar-form">
                    <div class="form-group">
                        <input class="form-control" placeholder="Enter keyword" spellcheck="false" type="text">
                        <button class="btn btn-search" type="submit"><i class="fa fa-search"></i></button>
                    </div>
                </form>
            </li>
            <li class="dropdown">
                <a class="dropdown-toggle f-s-14" data-toggle="dropdown" href="javascript:;">
                    <i class="fa fa-bell"></i>
                    <span class="label">5</span>
                </a>
                <ul class="dropdown-menu media-list dropdown-menu-right">
                    <li class="dropdown-header">NOTIFICATIONS (5)</li>
                    <li class="media">
                        <a href="javascript:;">
                            <div class="media-left">
                                <i class="fa fa-bug media-object bg-silver-darker"></i>
                            </div>
                            <div class="media-body">
                                <h6 class="media-heading">Server Error Reports <i
                                        class="fa fa-exclamation-circle text-danger"></i></h6>
                                <div class="text-muted f-s-11">3 minutes ago</div>
                            </div>
                        </a>
                    </li>
                    <li class="media">
                        <a href="javascript:;">
                            <div class="media-left">
                                <img alt="" class="media-object" src="images/user-1.jpg">
                                <i class="fab fa-facebook-messenger text-primary media-object-icon"></i>
                            </div>
                            <div class="media-body">
                                <h6 class="media-heading">John Smith</h6>
                                <p>Quisque pulvinar tellus sit amet sem scelerisque tincidunt.</p>
                                <div class="text-muted f-s-11">25 minutes ago</div>
                            </div>
                        </a>
                    </li>
                    <li class="media">
                        <a href="javascript:;">
                            <div class="media-left">
                                <img alt="" class="media-object" src="images/user-2.jpg">
                                <i class="fab fa-facebook-messenger text-primary media-object-icon"></i>
                            </div>
                            <div class="media-body">
                                <h6 class="media-heading">Olivia</h6>
                                <p>Quisque pulvinar tellus sit amet sem scelerisque tincidunt.</p>
                                <div class="text-muted f-s-11">35 minutes ago</div>
                            </div>
                        </a>
                    </li>
                    <li class="media">
                        <a href="javascript:;">
                            <div class="media-left">
                                <i class="fa fa-plus media-object bg-silver-darker"></i>
                            </div>
                            <div class="media-body">
                                <h6 class="media-heading"> New User Registered</h6>
                                <div class="text-muted f-s-11">1 hour ago</div>
                            </div>
                        </a>
                    </li>
                    <li class="media">
                        <a href="javascript:;">
                            <div class="media-left">
                                <i class="fa fa-envelope media-object bg-silver-darker"></i>
                                <i class="fab fa-google text-warning media-object-icon f-s-14"></i>
                            </div>
                            <div class="media-body">
                                <h6 class="media-heading"> New Email From John</h6>
                                <div class="text-muted f-s-11">2 hour ago</div>
                            </div>
                        </a>
                    </li>
                    <li class="dropdown-footer text-center">
                        <a href="javascript:;">View more</a>
                    </li>
                </ul>
            </li>
            <li class="dropdown navbar-user">
                <a class="dropdown-toggle" data-toggle="dropdown" href="javascript:;">
                    <img alt="" src="images/user-13.jpg">
                    <span class="d-none d-md-inline">{{fullname}}</span> <b class="caret"></b>
                </a>
                <div class="dropdown-menu dropdown-menu-right">
                    <a class="dropdown-item" href="javascript:;">Chỉnh sửa thông tin</a>
                    <a class="dropdown-item" href="javascript:;"><span class="badge badge-danger pull-right">2</span>
                        Inbox</a>

                    <div class="dropdown-divider"></div>
                    <a class="dropdown-item" href="/logout">Đăng xuất</a>
                </div>
            </li>
        </ul>
        <!-- end header navigation right -->
    </div>

    <div class="sidebar" id="sidebar">
        <!-- begin sidebar scrollbar -->
        <div data-height="100%" data-scrollbar="true">
            <!-- begin sidebar user -->
            <ul class="nav">
                <li class="nav-profile">
                    <a data-toggle="nav-profile" href="javascript:;">

                        <div class="info">
                            <b class="caret pull-right"></b>
                            {{fullname}}
                            <small>Trial</small>
                        </div>
                    </a>
                </li>
                <li>
                    <ul class="nav nav-profile">
                        <li><a href="javascript:;"><i class="fa fa-cog"></i> Cài Đặt</a></li>
                        <li><a href="javascript:;"><i class="fa fa-pencil-alt"></i> Phản Hồi</a></li>
                        <li><a href="javascript:;"><i class="fa fa-question-circle"></i> Trợ Giúp</a></li>
                    </ul>
                </li>
            </ul>
            <!-- end sidebar user -->
            <!-- begin sidebar nav -->
            <ul class="nav">
                <li class="nav-header">Danh mục</li>
                <li class="has-sub">
                    <a href="javascript:;">
                        <b class="caret"></b>
                        <i class="fa fa-th-large"></i>
                        <span>Quản lí tài khoản</span>
                    </a>
                    <ul class="sub-menu">
                        <li><a href="/api/addCookie">Thêm bằng Cookie</a></li>
                        <li><a href="/api/account">Thêm bằng User/Pass</a></li>
                    </ul>
                </li>
                <li class="has-sub ">
                    <a href="javascript:;">
                        <span class="badge pull-right">10</span>
                        <i class="fa fa-hdd"></i>
                        <span>Trò Chuyện</span>
                    </a>
                    <ul class="sub-menu">
                        <li><a href="email_inbox.html">Inbox</a></li>
                        <li><a href="email_compose.html">Compose</a></li>
                        <li><a href="email_detail.html">Detail</a></li>
                    </ul>
                </li>
                <li class="active">
                    <a href="/api/autoChat">
                        <i class="fab fa-simplybuilt"></i>
                        <span>Trả lời tự động <span class="label label-theme m-l-5">NEW</span></span>
                    </a>
                </li>
                <li class="has-sub">
                    <a href="/api/scenario">

                        <i class="fa fa-gem"></i>
                        <span>Kịch bản <span class="label label-theme m-l-5">NEW</span></span>
                    </a>

                </li>

                <li class="has-sub">
                    <a href="/api/mutiplesms">

                        <i class="fa fa-list-ol"></i>
                        <span>Hẹn Giờ <span class="label label-theme m-l-5">NEW</span></span>
                    </a>

                </li>

                <!-- begin sidebar minify button -->
                <li><a class="sidebar-minify-btn" data-click="sidebar-minify" href="javascript:;"><i
                        class="fa fa-angle-double-left"></i></a></li>
                <!-- end sidebar minify button -->
            </ul>
            <!-- end sidebar nav -->
        </div>
        <!-- end sidebar scrollbar -->
    </div>
    <div class="sidebar-bg"></div>
    <div class="content content-full-width inbox" id="content">
        <div class="panel panel-inverse">
            <!-- begin panel-heading -->
            <div class="panel-heading ui-sortable-handle" style="background-color: #2c3e50">
                <div class="panel-heading-btn">
                    <a href="javascript:;" class="btn btn-xs btn-icon btn-circle btn-default" data-click="panel-expand"><i class="fa fa-expand"></i></a>
                    <a href="javascript:;" class="btn btn-xs btn-icon btn-circle btn-success" data-click="panel-reload"><i class="fa fa-redo"></i></a>
                    <a href="javascript:;" class="btn btn-xs btn-icon btn-circle btn-warning" data-click="panel-collapse"><i class="fa fa-minus"></i></a>
                    <a href="javascript:;" class="btn btn-xs btn-icon btn-circle btn-danger" data-click="panel-remove"><i class="fa fa-times"></i></a>
                </div>
                <h4  class="panel-title">Trả lời tin nhắn tự động</h4>
            </div>
            <div class="panel-body">
                <div class="form-horizontal" data-parsley-validate="true" name="demo-form" novalidate="">
                    <div class="form-group row m-b-15">
                        <label class="col-md-4 col-sm-4 col-form-label">Danh sách từ khóa * :</label>
                        <div class="col-md-6 col-sm-6">
                            <div class="form-control" data-parsley-required="true"
                                 style="overflow-x: scroll;overflow-y: hidden;padding-right: 20px"
                                 type="text">

                                <span class="label label-inverse" style="margin-right:5px;margin-top:5px"
                                      v-for="data in content.keyList">{{data}} <span @click="removeKey(data)"
                                                                                     class="removeKey">x</span></span>


                            </div>
                        </div>
                        <div class="col-md-2 col-sm-2">
                            <input @keyup.13="addKey" autocomplete="off" class="form-control"
                                   data-parsley-required="true"
                                   name="fullname" placeholder="Từ khóa" spellcheck="false" type="text"
                                   v-model="keyword">
                        </div>
                    </div>

                    <div class="form-group row m-b-15">
                        <label class="col-md-4 col-sm-4 col-form-label" for="message">Nội dung :</label>
                        <div class="col-md-8 col-sm-8">
                            <textarea  v-model="content.message" class="form-control" data-parsley-range="[20,200]" id="message" name="message"
                                      placeholder="Nội dung"
                                      rows="4" spellcheck="false"></textarea>
                        </div>
                    </div>
                    <div class="form-group row m-b-15">
                        <label class="col-md-4 col-sm-4 col-form-label" for="message">Tài khoản :</label>
                        <div class="col-md-8 col-sm-8">
                            <div class="form-check">



                                <span :key="index" v-for="(data,index) in account" style="margin-right: 30px">

                                     <input  v-model="content.select" :value="data.ID_sender" class="form-check-input" data-parsley-mincheck="2"
                                            data-parsley-multiple="mincheck"
                                            id="mincheck" required="" spellcheck="false" type="checkbox"
                                            value="foo">
                                <label class="form-check-label">{{data.FacebookName}}</label>


                                </span>

                            </div>


                        </div>
                    </div>
                    <div class="form-group row m-b-15">
                        <label class="col-md-4 col-sm-4 col-form-label" for="message"></label>
                        <div class="col-md-2 col-sm-2">
                        <div class="form-check">

                            <button v-show="addDisplay" @click="addContent" class="btn btn-outline-danger" style="margin-left: -20px">Add</button>
                            <button v-show="updateDisplay" @click="updateContent" class="btn btn-outline-primary"  style="margin-left: -20px">Update</button>




                        </div>
                        </div>
                        <div v-show="errorShow" class="col-md-6 col-sm-6">
                            <div class="form-check">
                                <br>
                                <code style="background: none;color:white;border:1px solid red;margin-left: -20px;" class="animated flash" v-show="errorShow">{{error}}</code>




                            </div>
                        </div>
                    </div>

                </div>
            </div>
            <div class="panel-body">
                <div class="dataTables_wrapper form-inline dt-bootstrap no-footer" id="data-table-default_wrapper">

                    <div class="row">
                        <div class="col-sm-6">
                        </div>
                        <div class="col-sm-6">
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-12">
                            <div class="table-responsive">
                                <table class="table table-striped table-bordered">
                                    <thead>
                                    <tr>
                                        <th width="1%">STT</th>
                                        <th class="text-nowrap"></th>
                                        <th class="text-nowrap">ID</th>
                                        <th class="text-nowrap">Facebook</th>
                                        <th class="text-nowrap">Tình trạng</th>
                                        <th class="text-nowrap"></th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    <tr  v-for="(data,index) in contentArr" :key="index">
                                        <td >{{index+1}}</td>
                                        <td>
                                            <span v-for="data1 in data.keyList" style="margin-right:5px" class="label label-inverse">{{data1}}</span>

                                        </td>
                                        <td>{{data.message}}</td>
                                        <td><span v-for="data2 in data.select">{{findName(data2)}},</span></td>
                                        <td><i @click="editContent(data)" class="cur fa fa-edit text-danger"></i></td>
                                        <td><i @click="removeContent(data)" class="cur fa fa-trash text-primary"></i></td>

                                    </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-sm-7">
                            <div class="dataTables_paginate paging_simple_numbers" id="data-table-default_paginate" v-show="pagination">
                                <ul class="pagination">
                                    <li class="paginate_button previous disabled" id="data-table-default_previous"><a
                                            aria-controls="data-table-default" data-dt-idx="0" href="#" tabindex="0">Previous</a>
                                    </li>
                                    <li class="paginate_button active"><a aria-controls="data-table-default"
                                                                          data-dt-idx="1"
                                                                          href="#" tabindex="0">1</a></li>
                                    <li class="paginate_button "><a aria-controls="data-table-default" data-dt-idx="2"
                                                                    href="#" tabindex="0">2</a></li>
                                    <li class="paginate_button "><a aria-controls="data-table-default" data-dt-idx="3"
                                                                    href="#" tabindex="0">3</a></li>
                                    <li class="paginate_button "><a aria-controls="data-table-default" data-dt-idx="4"
                                                                    href="#" tabindex="0">4</a></li>
                                    <li class="paginate_button "><a aria-controls="data-table-default" data-dt-idx="5"
                                                                    href="#" tabindex="0">5</a></li>
                                    <li class="paginate_button "><a aria-controls="data-table-default" data-dt-idx="6"
                                                                    href="#" tabindex="0">6</a></li>
                                    <li class="paginate_button next" id="data-table-default_next"><a
                                            aria-controls="data-table-default"
                                            data-dt-idx="7"
                                            href="#"
                                            tabindex="0">Next</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <!-- end panel -->
        </div>
        <!-- end panel -->
    </div>
    <a class="btn btn-icon btn-circle btn-success btn-scroll-to-top fade" data-click="scroll-top" href="javascript:;"><i
            class="fa fa-angle-up"></i></a>
    <!-- end scroll to top btn -->
</div>
<!-- end page container -->

<!-- ================== BEGIN BASE JS ================== -->
<script src="/js/jquery-3.3.1.min.js"></script>
<script src="/js/jquery-ui.min.js"></script>
<script src="/js/bootstrap.bundle.min.js"></script>
<script src="/js/jquery.slimscroll.min.js"></script>
<script src="/js/js.cookie.js"></script>
<script src="/js/transparent.min.js"></script>
<script src="/js/apps.min.js"></script>
<!-- ================== END BASE JS ================== -->

<!-- ================== BEGIN PAGE LEVEL JS ================== -->
<script src="/js/email-inbox.demo.min.js"></script>
<!-- ================== END PAGE LEVEL JS ================== -->
<script>
    $(document).ready(function() {
        App.init();
        InboxV2.init();
    });
</script>
<script>

    function setCookie(cname,cvalue,exdays) {
        var d = new Date();
        d.setTime(d.getTime() + (exdays*24*60*60*1000));
        var expires = "expires=" + d.toGMTString();
        document.cookie = cname + "=" + cvalue + ";" + expires + ";path=/";
    }


    function getCookie(cname) {
        var name = cname + "=";
        var decodedCookie = decodeURIComponent(document.cookie);
        var ca = decodedCookie.split(';');
        for(var i = 0; i < ca.length; i++) {
            var c = ca[i];
            while (c.charAt(0) == ' ') {
                c = c.substring(1);
            }
            if (c.indexOf(name) == 0) {
                return c.substring(name.length, c.length);
            }
        }
        return "";
    }



    var app = new Vue({
        el: '#page-container',
        data(){
            return {
                updateDisplay:false,
                addDisplay:true,
                keyword:'',
                name:'testing',
                account:[],
                error:'test',
                content:{
                    keyList:[],
                    message:'',
                    select:[]
                },
                contentArr:[],
                pc:true,
                mobile:false,
                errorShow:false,
                findName:(id)=>{
                    return this.account.filter(e=>{
                        if(e.ID_sender === id){
                            return e
                        }
                    })[0].FacebookName
                },
                fullname: '',
                pagination:false
            }
        },

        created: async  function(){
            let chat = await axios.post('/api/getAllConversation');
            this.fullname = chat.data.result.user.name;
            let width = window.innerWidth;

            if(width <= 768){

                this.pc = false;
                this.mobile = true;
            }else {
                this.pc = true;
                this.mobile = false;
            }

            let result = await axios.post('/api/getAutoChat');
            this.contentArr = result.data.chatBotKey;
            return this.account = result.data.AllAccount
        },
        computed: {

            filteredList() {
                let _ = this;
                return this.listFriend.filter(e=>{
                    return e.fullName.toLowerCase().includes(_.search.toLowerCase())
                })

            },



        },
        beforeMount:function(){


        },
        mounted:function(){


        },
        methods:{
            addKey:function () {
                this.content.keyList.push(this.keyword);
                this.keyword = '';

            },
            format:function(){
                this.keyword = '';
            },
            removeKey:function(data){
                this.content.keyList = this.content.keyList.filter(e=>{

                    if(e !== data){
                        return e
                    }
                })
                return this.content
            },
            addContent:async function () {
                this.errorShow = false;
                if(this.content.keyList.length === 0){
                    this.errorShow = true;
                    return this.error = 'Bạn không được để trống list từ khóa'
                }
                if(this.content.select.length === 0){
                    this.errorShow = true;
                    return this.error = 'Bạn phải chọn ít nhất 1 tài khoản để áp dụng chế độ này'
                }
                if(this.content.message === ''){
                    this.errorShow = true;
                    return this.error = 'Bạn phải chọn nội dung trả lời tự động'
                }
                this.contentArr.push(this.content);
                let sendContent = await axios.post('/api/addAutoChat', this.content);
                return location.reload();
            },
            editContent:function(data){
                this.updateDisplay = true;
                this.addDisplay = false;
                this.content = data
            },
            removeContent:async function(data){

                let sendKeyDelete = await axios.post('/api/deleteAutoChat',{KeySecure:data.KeySecure});
                return location.reload();

            },
            updateContent:async function(){
                let sendContent = await axios.post('/api/updateAutoChat',this.content);
                return location.reload();
            }

        },
    })

</script>
</body>
</html>
